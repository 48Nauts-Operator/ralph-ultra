{
  "project": "ralph-ultra-phase4",
  "description": "Phase 4: Execution Modes & Model Selection Cleanup - Add Super Saver/Fast Delivery modes, clean up hardcoded model references, add mode selector UI",
  "branchName": "ralph/phase4-execution-modes",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add ExecutionMode type to core types",
      "description": "Create ExecutionMode type ('balanced' | 'super-saver' | 'fast-delivery') in src/core/types.ts with associated configuration interfaces.",
      "acceptanceCriteria": [
        {
          "id": "AC-001-1",
          "text": "ExecutionMode type exists in src/core/types.ts with three modes: balanced, super-saver, fast-delivery",
          "testCommand": "grep -q \"ExecutionMode\" src/core/types.ts && grep -q \"balanced\" src/core/types.ts && grep -q \"super-saver\" src/core/types.ts && grep -q \"fast-delivery\" src/core/types.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:37:41.740Z"
        },
        {
          "id": "AC-001-2",
          "text": "ExecutionModeConfig interface exists with mode, description, and modelStrategy fields",
          "testCommand": "grep -q \"ExecutionModeConfig\" src/core/types.ts && grep -q \"modelStrategy\" src/core/types.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:37:41.740Z"
        },
        {
          "id": "AC-001-3",
          "text": "ExecutionPlan interface updated to include selectedMode field",
          "testCommand": "grep -q \"selectedMode\" src/core/types.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:37:41.740Z"
        }
      ],
      "complexity": "simple",
      "passes": true
    },
    {
      "id": "US-002",
      "title": "Create mode-specific model mappings",
      "description": "Add SUPER_SAVER_MAPPING and FAST_DELIVERY_MAPPING constants to capability-matrix.ts that define which models to use for each task type in each mode.",
      "acceptanceCriteria": [
        {
          "id": "AC-002-1",
          "text": "SUPER_SAVER_MAPPING constant exists mapping task types to cheap models (haiku, gpt-4o-mini, gemini-flash)",
          "testCommand": "grep -q \"SUPER_SAVER_MAPPING\" src/core/capability-matrix.ts && grep -q \"haiku\\|gpt-4o-mini\\|gemini\" src/core/capability-matrix.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:39:49.170Z"
        },
        {
          "id": "AC-002-2",
          "text": "FAST_DELIVERY_MAPPING constant exists mapping task types to premium models (opus, sonnet, gpt-4o)",
          "testCommand": "grep -q \"FAST_DELIVERY_MAPPING\" src/core/capability-matrix.ts && grep -q \"opus\" src/core/capability-matrix.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:39:49.170Z"
        },
        {
          "id": "AC-002-3",
          "text": "getRecommendedModel function accepts optional mode parameter and uses appropriate mapping",
          "testCommand": "grep -q \"getRecommendedModel.*mode\\|mode.*ExecutionMode\" src/core/capability-matrix.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:39:49.170Z"
        }
      ],
      "complexity": "medium",
      "passes": true
    },
    {
      "id": "US-003",
      "title": "Update execution planner to support modes",
      "description": "Modify generateExecutionPlan to accept an ExecutionMode parameter and generate plans optimized for that mode.",
      "acceptanceCriteria": [
        {
          "id": "AC-003-1",
          "text": "generateExecutionPlan accepts mode parameter with default 'balanced'",
          "testCommand": "grep -q \"generateExecutionPlan.*mode\\|mode.*ExecutionMode\" src/core/execution-planner.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:41:51.151Z"
        },
        {
          "id": "AC-003-2",
          "text": "Generated plan includes selectedMode in output",
          "testCommand": "grep -q \"selectedMode\" src/core/execution-planner.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:41:51.151Z"
        },
        {
          "id": "AC-003-3",
          "text": "Plan comparisons section shows cost/duration for all three modes",
          "testCommand": "grep -q \"superSaver\\|fastDelivery\" src/core/execution-planner.ts",
          "passes": true,
          "lastRun": "2026-01-24T15:41:51.151Z"
        }
      ],
      "complexity": "medium",
      "passes": true
    },
    {
      "id": "US-004",
      "title": "Clean up hardcoded model in getCLIConfig",
      "description": "Remove the hardcoded 'sonnet' model in getCLIConfig function (line ~1158) and make it use the model from execution plan or a configurable default.",
      "acceptanceCriteria": [
        {
          "id": "AC-004-1",
          "text": "getCLIConfig uses model parameter or DEFAULT_MODEL variable (not hardcoded string)",
          "testCommand": "grep -A 15 'case .claude.:' src/utils/ralph-service.ts | grep -q 'DEFAULT_MODEL\\|claudeModel'",
          "passes": true,
          "lastRun": "2026-01-24T18:42:23.095Z"
        },
        {
          "id": "AC-004-2",
          "text": "DEFAULT_MODEL constant exists at top of ralph-service.ts for fallback",
          "testCommand": "grep -q \"DEFAULT_MODEL\\|defaultModel\" src/utils/ralph-service.ts",
          "passes": true,
          "lastRun": "2026-01-24T18:42:23.095Z"
        },
        {
          "id": "AC-004-3",
          "text": "getCLIConfig uses model parameter or DEFAULT_MODEL instead of hardcoded value",
          "testCommand": "grep -A 20 \"getCLIConfig\" src/utils/ralph-service.ts | grep -q \"model\\|Model\"",
          "passes": true,
          "lastRun": "2026-01-24T18:42:23.095Z"
        }
      ],
      "complexity": "simple",
      "passes": true
    },
    {
      "id": "US-005",
      "title": "Add mode selector to ExecutionPlanView",
      "description": "Add UI controls to ExecutionPlanView allowing user to toggle between execution modes and see cost/duration change in real-time.",
      "acceptanceCriteria": [
        {
          "id": "AC-005-1",
          "text": "ExecutionPlanView displays current mode with visual indicator",
          "testCommand": "grep -q \"mode\\|Mode\" src/components/ExecutionPlanView.tsx && grep -q \"balanced\\|saver\\|fast\" src/components/ExecutionPlanView.tsx",
          "passes": true,
          "lastRun": "2026-01-24T18:46:11.447Z"
        },
        {
          "id": "AC-005-2",
          "text": "Keyboard shortcut 'm' cycles through modes (balanced -> super-saver -> fast-delivery)",
          "testCommand": "grep -q \"'m'\\|key.*m\" src/components/ExecutionPlanView.tsx",
          "passes": true,
          "lastRun": "2026-01-24T18:46:11.447Z"
        },
        {
          "id": "AC-005-3",
          "text": "Mode comparison section shows all three modes with their total cost and duration",
          "testCommand": "grep -q \"comparison\\|Comparison\\|superSaver\\|fastDelivery\" src/components/ExecutionPlanView.tsx",
          "passes": true,
          "lastRun": "2026-01-24T18:46:11.447Z"
        }
      ],
      "complexity": "medium",
      "passes": true
    },
    {
      "id": "US-006",
      "title": "Update useExecutionPlan hook to support modes",
      "description": "Modify useExecutionPlan hook to accept mode parameter and regenerate plan when mode changes.",
      "acceptanceCriteria": [
        {
          "id": "AC-006-1",
          "text": "useExecutionPlan accepts mode parameter",
          "testCommand": "grep -q \"useExecutionPlan.*mode\\|mode.*ExecutionMode\" src/hooks/useExecutionPlan.tsx",
          "passes": true,
          "lastRun": "2026-01-24T18:47:01.489Z"
        },
        {
          "id": "AC-006-2",
          "text": "Hook returns setMode function to change execution mode",
          "testCommand": "grep -q \"setMode\" src/hooks/useExecutionPlan.tsx",
          "passes": true,
          "lastRun": "2026-01-24T18:47:01.489Z"
        },
        {
          "id": "AC-006-3",
          "text": "Plan regenerates when mode changes (useEffect dependency)",
          "testCommand": "grep -q \"useEffect\" src/hooks/useExecutionPlan.tsx && grep -q \"mode\" src/hooks/useExecutionPlan.tsx",
          "passes": true,
          "lastRun": "2026-01-24T18:47:01.489Z"
        }
      ],
      "complexity": "simple",
      "passes": true
    },
    {
      "id": "US-007",
      "title": "Persist selected mode in settings",
      "description": "Save and load the user's preferred execution mode from settings.json so it persists across sessions.",
      "acceptanceCriteria": [
        {
          "id": "AC-007-1",
          "text": "Settings interface includes executionMode field",
          "testCommand": "grep -q \"executionMode\" src/utils/config.ts",
          "passes": true,
          "lastRun": "2026-01-24T18:52:26.619Z"
        },
        {
          "id": "AC-007-2",
          "text": "loadSettings returns executionMode with 'balanced' as default",
          "testCommand": "grep -q \"executionMode.*balanced\\|balanced.*executionMode\" src/utils/config.ts",
          "passes": true,
          "lastRun": "2026-01-24T18:52:26.619Z"
        },
        {
          "id": "AC-007-3",
          "text": "saveSettings persists executionMode to settings.json",
          "testCommand": "grep -q \"executionMode\" src/utils/config.ts && test -f src/utils/config.ts",
          "passes": true,
          "lastRun": "2026-01-24T18:52:26.619Z"
        }
      ],
      "complexity": "simple",
      "passes": true
    },
    {
      "id": "US-008",
      "title": "Pass selected mode to RalphService execution",
      "description": "When Ralph runs, use the selected execution mode to determine which model to use for each story.",
      "acceptanceCriteria": [
        {
          "id": "AC-008-1",
          "text": "RalphService loadOrGenerateExecutionPlan uses mode from settings",
          "testCommand": "grep -q \"executionMode\\|mode\" src/utils/ralph-service.ts && grep -q \"loadSettings\\|settings\" src/utils/ralph-service.ts",
          "passes": false,
          "lastRun": null
        },
        {
          "id": "AC-008-2",
          "text": "Log output shows which mode is being used for execution",
          "testCommand": "grep -q \"mode.*log\\|log.*mode\\|Mode:\" src/utils/ralph-service.ts",
          "passes": false,
          "lastRun": null
        },
        {
          "id": "AC-008-3",
          "text": "Model selection respects the execution mode setting",
          "testCommand": "grep -q \"mode\" src/utils/ralph-service.ts",
          "passes": false,
          "lastRun": null
        }
      ],
      "complexity": "medium",
      "passes": false
    },
    {
      "id": "US-009",
      "title": "Add mode indicator to StatusBar",
      "description": "Display the current execution mode in the StatusBar so users always know which mode is active.",
      "acceptanceCriteria": [
        {
          "id": "AC-009-1",
          "text": "StatusBar displays current execution mode",
          "testCommand": "grep -q \"mode\\|Mode\" src/components/StatusBar.tsx",
          "passes": false,
          "lastRun": null
        },
        {
          "id": "AC-009-2",
          "text": "Mode indicator uses distinct colors/icons for each mode (e.g., $ for saver, rocket for fast)",
          "testCommand": "grep -q \"saver\\|fast\\|balanced\\|ðŸ’°\\|ðŸš€\\|âš–\" src/components/StatusBar.tsx",
          "passes": false,
          "lastRun": null
        }
      ],
      "complexity": "simple",
      "passes": false
    },
    {
      "id": "US-010",
      "title": "Export Phase 4 types and ensure typecheck passes",
      "description": "Export all new Phase 4 types from core index and ensure the full project typechecks cleanly.",
      "acceptanceCriteria": [
        {
          "id": "AC-010-1",
          "text": "ExecutionMode type is exported from core/index.ts or types/index.ts",
          "testCommand": "grep -q \"ExecutionMode\" src/core/index.ts || grep -q \"ExecutionMode\" src/types/index.ts",
          "passes": false,
          "lastRun": null
        },
        {
          "id": "AC-010-2",
          "text": "TypeScript compiles without errors",
          "testCommand": "cd /Volumes/DevHub_ext/factory/toolbox/ralph-ultra && bun run typecheck",
          "passes": false,
          "lastRun": null
        },
        {
          "id": "AC-010-3",
          "text": "getCLIConfig and buildTmuxCommand use variables for model, not hardcoded strings",
          "testCommand": "grep -A 5 'case .claude.:' src/utils/ralph-service.ts | grep -q 'claudeModel\\|model\\|DEFAULT_MODEL'",
          "passes": false,
          "lastRun": null
        }
      ],
      "complexity": "simple",
      "passes": false
    }
  ]
}